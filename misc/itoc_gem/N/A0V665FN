µo«H¤H: peterkim.bbs@processor.tfcis.org (¨S¦³½ä¹Bªº½ä¯«), ¬ÝªO: plan
¼Ð  ÃD: [¥\¯à]ID «H¥ó¦Û°ÊÂà±H¨ì Internet «H½c
µo«H¯¸: XEON (Thu, 27 Feb 2003 16:33:42 +0800 (CST))      Updated: 2003/03/03

  ¥u¦Û°ÊÂà±H¯¸¤º«H

: maple.p ¥[¤@¦æ

+ int m_setforward(void);

: menu.c ¾A·íªº¿ï³æ¥[¤J³o¿ï¶µ

+ m_setforward, PERM_BASIC, M_SMAIL,
+ "AutoForward¢u ¦Û°ÊÂà±H ¢t",

: mail.c ¦b void mail_hold() «á¥[³o¨â­Ó function

int
m_setforward()
{
  char fpath[64], ip[50];
  FILE *fp;

  usr_fpath(fpath, cuser.userid, "forward");
  if (fp = fopen(fpath, "r"))
  {
    fscanf(fp, "%s", ip);
    fclose(fp);
  }
  else
  {
    ip[0] = '\0';
  }

  if (vget(b_lines - 1, 0, "½Ð¿é¤J«H¥ó¦Û°ÊÂà±Hªº E-mail¡G", ip, 50, GCARRY))
  {
    if (!not_addr(ip) && vans("½T©w¶}±Ò¦Û°ÊÂà«H¥\\¯à(Y/N)¡H[N] ") == 'y')
    {
      if (fp = fopen(fpath, "w"))
      {
        fprintf(fp, "%s", ip);
        fclose(fp);
        vmsg("³]©w§¹¦¨");
        return XEASY;
      }
    }
  }

  unlink(fpath);
  vmsg("¨ú®ø¦Û°ÊÂà±H©ÎµL®Ä E-mail");
  return XEASY;
}


static void
forward_mail(fpath, userid)
  char *fpath, *userid;
{
  FILE *fp;
  char buf[64], title[50], ip[50];

  usr_fpath(buf, userid, "forward");
  if (fp = fopen(buf, "r"))
  {
    fscanf(fp, "%s", ip);
    fclose(fp);

    if (ip[0])
    {
      sprintf(title, "¦Û°ÊÂà±H¦Û ¡i%s¡j%s ªº«H½c", BBSNAME, userid);
      bsmtp(fpath, title, ip, 0);
    }
  }
}

: mail.c:mail_send()

  rc = rec_add(folder, &mhdr, sizeof(mhdr));
  if (!rc)
  {
    mail_hold(fpath, rcpt);
  }

+ /* Internet ¦Û°ÊÂà±H */
+ forward_mail(fpath, rcpt);

  unlink(fpath);
  m_biff(userno);

  return rc;

--
    [1;32m¢~¢w¢w Origin ¢¡ [33;45m °Ê¤O®Ö¤ß [37m processor.tfcis.org [32;40m ¡ã £_£`£a ¢w¢w¢q[m
    [1;32m¢q     Author ¢£ [36m163.25.117.177[m
