µo«H¤H: itoc.bbs@cpu.tfcis.org (®Ö¤ß°Ê¤O) ¬ÝªO: plan
¼Ð  ÃD: Re: [°ÝÃD]Ãö©ó¬ÝªOÄÝ©Ê...
µo«H¯¸: °Ê¤O®Ö¤ß (2005/02/18 Fri 09:42:21)                Updated: 2005/02/18

¡° ¤Þ­z¡mdavidliu.bbs@bbs.dlit.edu.tw (David)¡n¤§»Ê¨¥¡G
> ½Ð°Ý¤@¤U¬O§_¦³¿ìªk³]©w¬Y¬ÝªO¬°"§R¤å«á¤å³¹¤£¶ideleted/junkªO"?
> ¦Ó¤£¬O¥u¦³¯¦±KªO¤~¥i³]©w¦¹¥\¯à¡C

: battr.h

  #define BRD_NOSCORE     0x40    /* ¤£µû¤À¬ÝªO */
+ #define BRD_NOGODELETE  0x80    /* §R¤å«á¤å³¹¤£¶i deleted/junk ªO */

- #define NUMBATTRS       7
- #define STR_BATTR       "zTcsvA%"
+ #define NUMBATTRS       8
+ #define STR_BATTR       "zTcsvA%d"

: battr.h:battr_tbl[]

  "¤£µû¤À¬ÝªO",                 /* BRD_NOSCORE */
+ "§R¤å¤£¶i [deleted]",         /* BRD_NOGODELETED */

: post.c:move_post()

  hdr_fpath(fpath, folder, hdr);

+ if (!((bshm->bcache + currbno)->battr & BRD_NOGODELETE))
+ {
    brd_fpath(fnew, board, fn_dir);
    hdr_stamp(fnew, HDR_LINK | 'A', &post, fpath);

    /* ª½±µ½Æ»s trailing data */

    memcpy(post.owner, hdr->owner, TTLEN + 140);

    if (by_bm)
      sprintf(post.title, "%-13s%.59s", cuser.userid, hdr->title);
    else if (!stat(fpath, &st))
      by_bm = st.st_size;

    rec_add(fnew, &post, sizeof(HDR));
    btime_update(brd_bno(board));
+ }
+ else
+ {
+   if (!stat(fpath, &st))
+     by_bm = st.st_size;
+ }

  unlink(fpath);
  btime_update(currbno);
  cancel_post(hdr);

--
 [1;43m¢«[46m¢ª[m Or[1mig[30min[m: [41m Maple-itoc£»°Ê¤O®Ö¤ß [36;47m cpu.tfcis.org [m
 [1;44m¢©[41m¢¨[m A[1mut[30mho[mr: [1;33mitoc [30m±q [31mitoc.Dorm11.NCTU.edu.tw [30mµoªí[m
