µo«H¤H: Dinsam.bbs@ccudream.twbbs.org («e¥@.. o.O) ¬ÝªO: plan
¼Ð  ÃD: [¥\¯à]¤H®ð«ü¼Æ/¦n©_«ü¼Æ
µo«H¯¸: ¤¤¥¿¿v¹Ú¶é (Sun, 07 Sep 2003 11:03:17 +0800)      Updated: 2005/02/18

  §ï struct ACCT¡A­nÂà´« .ACCT

: struct.h:struct ACCT

  int numlogins;        /* ¤W¯¸¦¸¼Æ */
  int numposts;         /* µoªí¦¸¼Æ */
+ int toquery;          /* ¦n©_«× */
+ int bequery;          /* ¤H®ð«× */

: acct.c:acct_show()

+ prints("  \033[32m¤H®ð«ü¼Æ¡G\033[37m%-35d\033[32m¦n©_«ü¼Æ¡G\033[37m%d\n",
+   u->bequery,u->toquery);

  prints("  \033[32m¶l¥ó«H½c¡G\033[37m%s\n", u->email);

: acct.c:acct_setup()

    sprintf(buf, "%d", u->gold);
    vget(++i, 0, "ª÷    ¹ô¡G", buf, 10, GCARRY);
    if ((num = atoi(buf)) >= 0)
      x.gold = num;

+   sprintf(buf, "%d", u->toquery);
+   vget(++i, 0, "¦n ©_ «×¡G", buf, 10, GCARRY);
+   if ((num = atoi(buf)) >= 0)
+     x.toquery = num;

+   sprintf(buf, "%d", u->bequery);
+   vget(++i, 0, "¤H ®ð «×¡G", buf, 10, GCARRY);
+   if ((num = atoi(buf)) >= 0)
+     x.bequery = num;

: bbsd.c:u_exit()

        cuser.userlevel = tuser.userlevel;
        cuser.tvalid = tuser.tvalid;
+       cuser.bequery = tuser.bequery;

: acct.c:u_setup() ©³¤U·s¼W¦¹¨ç¦¡

void
acct_bequery(acct)
  ACCT *acct;
{
  acct->bequery++;
  acct_save(acct);
}

: maple.p

  int acct_get(char *msg, ACCT *acct);
+ void acct_bequery(ACCT *acct);

: talk.c:do_query()

  UTMP *up;
  int userno, rich;
+ static int lastQueryUserno = -1;      /* °O¿ý¤W¤@­Ó¬d¸ßªº¤H */

  ...
  ...

+ prints("[¤H®ð«ü¼Æ] %d [¦n©_«ü¼Æ] %d\n", acct->bequery, acct->toquery);

  prints("[¨Ó·½] (%s) %s\n",
    Btime(&acct->lastlogin), acct->lasthost);

  ...
  ...

+ /* ¦pªG¬d¸ßªÌ¤£¬O¦Û¤v©Îguest¡A¤]¸ò¤W¤@­Ó¬d¸ßªº¤£¦P¡A¨º»ò¥[¤H®ð¡B¦n©_«ü¼Æ */
+ if (acct->userno != lastQueryUserno &&
+   strcmp(userid, cuser.userid) && strcmp(STR_GUEST, cuser.userid))
+ {
+   lastQueryUserno = acct->userno;
+   acct_bequery(acct);
+   cuser.toquery++;
+ }

  showplans(userid);

¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w¢w

  ¥H¤U¬O¤H®ð¡B¦n©_«ü¼Æ¤§±Æ¦æº]¡A¤]¥i¤£°µ

: topusr.c

#define OUTFILE_BIRTHDAY BBSHOME"/gem/@/@-birthday"
+ #define OUTFILE_TOPTOQUERY BBSHOME"/gem/@/@-toquery"
+ #define OUTFILE_TOPBEQUERY BBSHOME"/gem/@/@-bequery"

...

- static DATA toplogins[TOPNUM], topposts[TOPNUM],
-       topmoney[TOPNUM], topgold[TOPNUM];
+ static DATA toplogins[TOPNUM], topposts[TOPNUM],
+       topmoney[TOPNUM], topgold[TOPNUM],
+       toptoquery[TOPNUM],topbequery[TOPNUM];

: topusr.c:topusr()

+ if ((p = findmin(&toptoquery))->num < acct->toquery)
+ {
+   str_ncpy(p->userid, acct->userid, sizeof(p->userid));
+   str_ncpy(p->username, acct->username, sizeof(p->username));
+   p->num = acct->toquery;
+ }

+ if ((p = findmin(&topbequery))->num < acct->bequery)
+ {
+   str_ncpy(p->userid, acct->userid, sizeof(p->userid));
+   str_ncpy(p->username, acct->username, sizeof(p->username));
+   p->num = acct->bequery;
+ }
}

: topusr.c:main()

  memset(&topgold, 0, sizeof(topgold));
+ memset(&toptoquery, 0, sizeof(toptoquery));
+ memset(&topbequery, 0, sizeof(topbequery));

  ...
  ...

  qsort(topgold, TOPNUM, sizeof(DATA), sort_compare);
  write_data(OUTFILE_TOPGOLD, "ª÷¹ô´I»¨§ì¨gº]", &topgold);

+ qsort(toptoquery, TOPNUM, sizeof(DATA), sort_compare);
+ write_data(OUTFILE_TOPTOQUERY, "¦n©_«ü¼Æ±Æ¦æº]", &toptoquery);

+ qsort(topbequery, TOPNUM, sizeof(DATA), sort_compare);
+ write_data(OUTFILE_TOPBEQUERY, "¤H®ð«ü¼Æ±Æ¦æº]", &topbequery);

: BBS ¯¸¤W (A)nnounce

  ¸Ì­±·s¼W (D)¸ê®Æ ¤Gµ§

  ¼ÐÃD¡G¦n©_«ü¼Æ±Æ¦æº]
  ÀÉ¦W¡G-toquery

  ¼ÐÃD¡G¤H®ð«ü¼Æ±Æ¦æº]
  ÀÉ¦W¡G-bequery

--
[m[1;33m¡´[36m     [37m£»[36m    [37m£»[36m ¢¨¢h¢© ¢¨¢h¢© ¢h  ¢h ¢i¢h¢© ¢i¢h¢© ¢i¢h¢© ¢¨¢h¢© ¢i¢h¢p   [33m¡þ[m
  [1m£»[m [1;33m¢­[37m         ¢i     ¢i     ¢i  ¢i ¢i  ¢p ¢i  ¢p ¢i¢g   ¢i¢g¢p ¢p¢p¢p [33m¡¹[m
[32m¢¨[37;42m     [1;33m¡¹[37m£»     [33m¢ª¢i¢« ¢ª¢i¢« ¢ª¢i¢« ¢i¢i¢« ¢i¢ª¢g ¢i¢g¢« ¢i  ¢p ¢p¢p¢p[37m£»[;37;42m  [32;40m¢©[m
[32;42m  [1;37m¢Ñ¢Ò¢Ð¢Ð¢á  [32m¤¤¥¿[35m¿v¹Ú¶é[36mBBS¯¸ [31mÅwªï»YÁ{°ÑÆ[[32m cd.twbbs.org  (140.123.20.230)[36m [;37;42m   [m
[1;32m http://cd.twbbs.org[;32;40m¢ª[30;42m [1;33m [37m¡¯[32m [37mAuthor:[;30;42m Dinsam      [1;37m¡¹ From:[;30;42m 218.171.110.27  [1;32m  [33m [;32;40m¢«[m
