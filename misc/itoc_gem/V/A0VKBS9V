µo«H¤H: qazq.bbs@bbs.cs.nchu.edu.tw (§Ú¦b­úª_....²\ºw...) ¬ÝªO: plan
¼Ð  ÃD: [¥\¯à] ¤å³¹¦¬¿ýºëµØ°Ï¥[¤W¼Ð°O¢ï¡C
µo«H¯¸: ¤¤¿³¸ê¬ì (Fri, 22 Aug 2003 17:46:42 +0800 (CST))  Updated: 2003/12/15

    ³o¥\¯à¤§«e itoc ¤j¤j¤w¸g¼g¹L¤F¡C

    ¤£¹L¦]¬°·sª©¥»ªº gem.c¡Bhdr.h ¦³¤F¤@¨ÇªºÅÜ°Ê¡A©Ò¥H­×§ï¤F¤@¤U¦A¶K¤@¦¸¡C



    §Ú§â post_copy() ¥[¤WºëµØ°Ï¼Ð°O®³±¼¤F¡C

    ¤£µM¦³ªO¥D½Æ»s¤F¦ý¬O¨S¦³¶K¨ìºëµØ°Ï¡AÁÙ¬O·|¥X²{¢ï¨Ó¼Ð°O¡C

    °®¯Ü´N¼g¤F¤@¬qµ{¦¡¡A¥i¥HÅýªO¥D¦Û¦æ¼Ð°O¦¬¨ìºëµØ°Ïªº¤å³¹¡A´N¹³¢õ¤@¼Ë¡C

    «öÁä¦Û³]¡A¤º³]¬O Ctrl + G


    ²¦³º¦³¤H¤£³ßÅw¬Ý¨ìº¡º¡ªº¢ï¡A¤]·|¦³¤H¬O¤£¤p¤ß¦¬¿ù¤å³¹ªº...^^a



    ¤£¹L¦³¤@­Ó«Ü©_©Çªº¦a¤è¡A¥Î©wÁã¦¬¤å¡A³æ½gªº¸Ü¡A°¨¤W´N·|Åã¥Ü¢ï

    ¦ý¬O¥ý¥Î t µM«á¤j¶q¦¬¤åªº¸Ü¡A´N­n¥ý°h¥X¬ÝªO¦A¶i¥h¤~¬Ýªº¨ì¡C

    ¦n©_©Ç­ò¡I¬OÀÉ®×­«¸üªº°ÝÃD¶Ü¡H¯«©_....


==============================================================================


: src/include/hdr.h

#define POST_MARKED 0x00000002  /* marked */

+#define POST_GEM    0x00000004  /* ¦¬¿ýºëµØ°Ï¼Ð°O */

#define POST_DELETE 0x00000080  /* ¼Ð°O«Ý¬åªº */


: src/maple/gem.c:gem_gather()

        rec_add(folder, &ghdr, sizeof(HDR));
        gem_log(folder, "¦¬¿ý", &ghdr);
      }

+     /* ±q¬ÝªO¦¬¿ý¨ìºëµØ°Ï¥B§Ú¬OªO¥D®É¡A­n¥[¤W POST_GEM */
+     if ((*dir == 'b') && (bbstate & STAT_BOARD) && !(xmode & POST_GEM))
+     {
+       /* update ÄÝ©Ê */
+
+       hdr->xmode = xmode | POST_GEM;
+       currchrono = hdr->chrono;
+
+#ifdef XZ_XPOST
+       rec_put(dir, hdr, sizeof(HDR), tag ? TagList[locus].recno :
+         (xo->key == XZ_XPOST ? hdr->xid : xo->pos), cmpchrono);
+#else
+       rec_put(dir, hdr, sizeof(HDR), tag ? TagList[locus].recno : xo->pos,
+         cmpchrono);
+#endif
+     }

    }
  } while (++locus < tag);

  ...
  ...

- return XO_FOOT;
+ return XO_LOAD;   /* update ÄÝ©Ê */
}


: maple/post.c:post_attr()


+ if ((bbstate & STAT_BOARD) && (mode & POST_GEM))      /* ªO¥D¤~¬Ý±o¨ì G/B */
+  attr |= (mode & POST_MARKED ? 'B' : 'G');        /* ­Y¦³ mark+gem¡AÅã¥Ü B */
+ else

#ifdef HAVE_LABELMARK
  if (mode & POST_DELETE)
    attr |= 'T';
  else
#endif



: post.c:post_gem_mark()    ·s¼W¾ã¤ä¨ç¦¡¦b post_mark() ¤U­±


static int
post_gem_mark(xo)       /* qazq.030822: ¦¬¿ýºëµØ°Ï¼Ð°O */
  XO *xo;
{
  if (bbstate & STAT_BOARD)
  {
    HDR *hdr;
    int pos, cur, xmode;

    pos = xo->pos;
    cur = pos - xo->top;
    hdr = (HDR *) xo_pool + cur;
    xmode = hdr->xmode;

#ifdef HAVE_LABELMARK
    if (xmode & POST_DELETE)    /* «Ý¬åªº¤å³¹¤£¯à mark */
      return XO_NONE;
#endif

    hdr->xmode = xmode ^ POST_GEM;
    currchrono = hdr->chrono;

    rec_put(xo->dir, hdr, sizeof(HDR), xo->key == XZ_XPOST ? 
      hdr->xid : pos, cmpchrono);
    move(3 + cur, 7);
    outc(post_attr(hdr));

    return pos + 1 + XO_MOVE;   /* ¸õ¦Ü¤U¤@¶µ */
  }
  return XO_NONE;
}


: post.c:post_cb[]

+ Ctrl('G'), post_gem_mark, /* qazq.030822: ¦¬¿ýºëµØ°Ï¼Ð°O */


: post.c:xpost_cb[]

+ Ctrl('G'), post_gem_mark, /* qazq.030822: ¦¬¿ýºëµØ°Ï¼Ð°O */

--
 [1m[42m¢z[41m¢q[m Au[1mth[30mor[m: [43m ¤¤¿³¸ê¬ì£»¤¤¿³¸ê¬ì ¢í¸ê¿W¨q [33;47m bbs.cs.nchu.edu.tw [m
 [1m[44m¢|[43m¢}[m O[1mri[30mgi[mn: [1;36mqazq [30m±q [35m61-216-251-124.HINET-IP.hinet.net [30mµoªí[m
