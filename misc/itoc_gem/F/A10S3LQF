µo«H¤H: itoc.bbs@cpu.tfcis.org (®Ö¤ß°Ê¤O) ¬ÝªO: plan
¼Ð  ÃD: Re: [¥\¯à] ¤å³¹¸m©³
µo«H¯¸: °Ê¤O®Ö¤ß (2004/12/17 Fri 01:37:37)                Updated: 2004/12/17

¡° ¤Þ­z¡mitoc (®Ö¤ß°Ê¤O)¡n¤§»Ê¨¥¡G
>   µL½×¤èªk¤@ÁÙ¬O¤èªk¤G¡Aµû¤À³£¬O¥i¥H³s°Ê¡A¥u¬O¤èªk¤G¨S¼g¦Ó¤w

  ¤èªk¤Gªº±À¤å¤À¼Æ³s°Ê

: hdr.h:struct HDR

- char xname[32];               /* ÀÉ®×¦WºÙ */
+ char xname[28];               /* ÀÉ®×¦WºÙ */
+ time_t parent_chrono;         /* ¸m©³¤åªº¥¿¥»¬O­þ½g */

: post.c:post_bottom()

    hdr_stamp(xo->dir, HDR_LINK | 'A', &post, fpath);
+   post.parent_chrono = hdr->chrono;
    post.xmode = POST_BOTTOM;

: post:post_score()

  if (curraddscore)
  {
    currchrono = hdr->chrono;
    rec_ref(dir, hdr, sizeof(HDR), xo->key == XZ_XPOST ?
      hdr->xid : pos, cmpchrono, addscore);

+   if (hdr->xmode & POST_BOTTOM)  /* ­Y¬Oµû¤À¸m©³¤å³¹¡A¥h§ä¥¿¥»¨Ó³s°Ê¤À¼Æ */
+   {
+     currchrono = hdr->parent_chrono;
+     rec_ref(dir, hdr, sizeof(HDR), 0, cmpchrono, addscore);
+   }
+   else                           /* ­Y¬Oµû¤À¤@¯ë¤å³¹¡A¥h§äÁÃ¥»¨Ó³s°Ê¤À¼Æ */
+   {
+     /* currchrono = hdr->chrono; */ /* «e­±¦³¤F */
+     rec_ref(dir, hdr, sizeof(HDR), 0, cmpparent, addscore);
+   }

    return XO_LOAD;
  }

: post.c:cmpparent() ¥[¦b cmpchrono() «á­±

static int
cmpparent(hdr)
  HDR *hdr;
{
  /* ¥i¥H¤£¥ÎÀË¬d POST_BOTTOM¡A¦]¬°¤@¯ë¤å³¹ªº parent_chrono = 0 */
  return /* (hdr->xmode & POST_BOTTOM) && */
    (hdr->parent_chrono == currchrono);
}


--
 [1;43m¢«[46m¢ª[m Or[1mig[30min[m: [41m Maple-itoc£»°Ê¤O®Ö¤ß [36;47m cpu.tfcis.org [m
 [1;44m¢©[41m¢¨[m A[1mut[30mho[mr: [1;33mitoc [30m±q [31mitoc.Dorm11.NCTU.edu.tw [30mµoªí[m
