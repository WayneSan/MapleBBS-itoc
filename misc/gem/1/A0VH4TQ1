µo«H¤H: qazq.bbs@bbs.cs.nchu.edu.tw (£i·R±¡±s¦u£i) ¬ÝªO: plan
¼Ð  ÃD: [¥\¯à] ¾ã¦æ¥ú´Î(3)¡Ðtalk.c ¨Ï¥ÎªÌ¦W³æ
µo«H¯¸: ¤¤¿³¸ê¬ì (Mon, 14 Jul 2003 16:27:29 +0800 (CST))  Updated: 2005/10/05

: ulist.c:ulist_item_bar()  ¥[¦b ulist_item() «á­±

#ifdef HAVE_LIGHTBAR
static void
ulist_item_bar(xo, mode)
  XO *xo;
  int mode;     /* 1:¤W¥ú´Î  0:¥h¥ú´Î */
{
  time_t diff, ftype;
  int userno, ufo;
  char pager, buf[15], *fcolor;
  UTMP *up;

  up = ulist_pool[xo->pos];

  if (!(userno = up->userno))
  {
    outs("      < ¦¹¦ìºô¤Í¥¿¥©Â÷¶} >\n");
    return;
  }

  /* itoc.011022: ­Y¥Í¤é·í¤Ñ¤W¯¸¡A­É¥Î idle Äæ¦ì¨Ó©ñ¹Ø¬P */
  if (up->status & STATUS_BIRTHDAY)
  {
    strcpy(buf, "\033[1;31m¹Ø¬P\033[m");
  }
  else
  {
#ifdef DETAIL_IDLETIME
    if ((diff = time(NULL) - up->idle_time) >= 60)   /* ¶W¹L 60 ¬í¤~ºâ¶¢¸m */
      sprintf(buf, "%3d'%02d", diff / 60, diff % 60);
#else
    if (diff = up->idle_time)
      sprintf(buf, "%2d", diff);
#endif
    else
      buf[0] = '\0';
  }

  ufo = up->ufo;

  /*         pager ª¬ºA                       */
  /*  #¡G¤£±µ¨ü¥ô¦ó¤H©I¥s¡A¤]¤£±µ¨ü¥ô¦ó¤H¼s¼½ */
  /*  *¡G¥u±µ¨ü¦n¤Í©I¥s¡A¥B¥u±µ¨ü¦n¤Í¼s¼½     */
  /*  !¡G¥u±µ¨ü¦n¤Í©I¥s¡A¦ý¤£±µ¨ü¥ô¦ó¤H¼s¼½   */
  /*  -¡G±µ¨ü¥ô¦ó¤H©I¥s¡A¦ý¤£±µ¨ü¥ô¦ó¤H¼s¼½   */
  /*   ¡G³£¨S¦³´N¬O¨S¦³­­¨î°Õ                 */
  if (ufo & UFO_QUIET)
  {
    pager = '#';
  }
  else if (ufo & UFO_PAGER)
  {
#ifdef HAVE_NOBROAD
    if (ufo & UFO_RCVER)
      pager = '!';
    else
#endif
      pager = '*';
  }
#ifdef HAVE_NOBROAD
  else if (ufo & UFO_RCVER)
  {
    pager = '-';
  }
#endif
  else
  {
    pager = ' ';
  }

  ftype = ulist_ftype[up - ushm->uslot];

  fcolor =
#ifdef HAVE_BRDMATE
# ifdef HAVE_ANONYMOUS
    up->mode == M_READA && !(currbattr & BRD_ANONYMOUS) &&
      !strcmp(currboard, up->mateid) ? COLOR_BRDMATE :
# else
    up->mode == M_READA && !strcmp(currboard, up->mateid) ? COLOR_BRDMATE :
#  endif
#endif
    ftype & FTYPE_NORMAL ? COLOR_NORMAL :
    ftype & FTYPE_BOTHGOOD ? COLOR_BOTHGOOD :
    ftype & FTYPE_MYGOOD ? COLOR_MYGOOD :
    ftype & FTYPE_OGOOD ? COLOR_OGOOD :
    ftype & FTYPE_SELF ? COLOR_SELF :
    ftype & FTYPE_MYBAD ? COLOR_MYBAD :
    "";

  prints("%s%6d%c%c%s%-13s%-*.*s\033[m%s%-*.*s%-11.10s%6s%s",
    mode ? "\033[45m" : "",
    xo->pos + 1, ufo & UFO_CLOAK ? ')' : ' ', pager,
    fcolor, up->userid,
    (d_cols >> 1) + 21, (d_cols >> 1) + 20, up->username,
    mode ? "\033[45m" : "",
    d_cols - (d_cols >> 1) + 19, d_cols - (d_cols >> 1) + 18,
    pickup_ship ? pal_ship(ftype, up->userno) :
#ifdef GUEST_WHERE
    (pager == ' ' || HAS_PERM(PERM_ALLACCT) ||
      ftype & (FTYPE_SELF | FTYPE_BOTHGOOD | FTYPE_OGOOD) || !up->userlevel) ?
#else
    (pager == ' ' || HAS_PERM(PERM_ALLACCT) ||
      ftype & (FTYPE_SELF | FTYPE_BOTHGOOD | FTYPE_OGOOD)) ?
#endif
    up->from : "*", bmode(up, 0), buf,
    mode ? "\033[m" : "");
}
#endif

: ulist.c:ulist_cb[]

static KeyFunc ulist_cb[] =
{
#ifdef  HAVE_LIGHTBAR
  XO_ITEM, ulist_item_bar,
#endif

--
[1;31m|[33m Origin [31m| [0;45m ¤¤¿³¸ê¬ì ¤¤¿³¸ê¬ì ¢í¸ê¿W¨q [35;47m bbs.cs.nchu.edu.tw [m
[1;31m|[35m Author [31m| [36m61-216-136-210.HINET-IP.hinet.net[m
